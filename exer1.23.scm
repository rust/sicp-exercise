(define (square x)
  (* x x ))
(define (smallest-divisor n)
  (find-divisor n 2))
(define (find-divisor n test-divisor)
  (cond ((> (square test-divisor) n) n)
        ((divide? test-divisor n ) test-divisor)
        (else (find-divisor n (next test-divisor)))))
(define (next n)
  (if (= (remainder n 2) 0)
      (+ n 1)
      (+ n 2)))
(define (divide? a b)
  (= (remainder b a) 0))
(define (prime? n)
  (= n (smallest-divisor n)))

(define (runtime)
  (- (time->seconds (current-time)) 1136041200))

(define (timed-prime-test n)
  (newline)
  (display n)
  (start-prime-test n (runtime)))

(define (start-prime-test n start-time)
  (if (prime? n)
      (report-prime (- (runtime) start-time))
      #f))

(define (report-prime elapsed-time)
  (display " *** ")
  (display elapsed-time)
  #t)

(timed-prime-test 13)

(define (search-for-primes n)
  (if (timed-prime-test n)
      #t
      (search-for-primes (+ n 2))))

;; => 101 (1.6927719116210937e-5)
;; => 103 (1.6927719116210937e-5)
;; => 107 (2.002716064453125e-5)
;; => 1009 (3.218650817871094e-5)
;; => 1013 (3.504753112792969e-5)
;; => 1019 (3.409385681152344e-5)
;; => 10007 (9.584426879882812e-5)
;; => 10009 (9.512901306152344e-5)
;; => 10037 (9.489059448242187e-5)
;; => 100003 (2.8705596923828125e-4)
;; => 100019 (2.86102294921875e-4)
;; => 100043 (2.8705596923828125e-4)
;; => 1000003 (8.828639984130859e-4)
;; => 1000033 (9.000301361083984e-4)
;; => 1000037 (8.85009765625e-4)
(search-for-primes 100) ;; => 101 (2.193450927734375e-5)
(search-for-primes 102) ;; => 103 (1.6927719116210937e-5)
(search-for-primes 104) ;; => 107 (1.4066696166992187e-5)
(search-for-primes 1001) ;; => 1009 (3.0994415283203125e-5)
(search-for-primes 1010) ;; => 1013 (3.504753112792969e-5)
(search-for-primes 1014) ;; => 1019 (3.1948089599609375e-5)
(search-for-primes 10001) ;; => 10007 (7.486343383789062e-5)
(search-for-primes 10008) ;; => 10009 (7.605552673339844e-5)
(search-for-primes 10010) ;; => 10037 (7.414817810058594e-5)
(search-for-primes 100001) ;; => 100003 (2.129077911376953e-4)
(search-for-primes 100004) ;; => 100019 (2.1505355834960937e-4)
(search-for-primes 100020) ;; => 100043 (2.1505355834960937e-4)
(search-for-primes 1000001) ;; => 1000003 (6.709098815917969e-4)
(search-for-primes 1000004) ;; => 1000033 (6.539821624755859e-4)
(search-for-primes 1000034) ;; => 1000037 (6.880760192871094e-4)
